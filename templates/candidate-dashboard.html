<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate War Room - Election Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename = 'css/dashboard.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename = 'css/candidate-dashboard-additions.css')}}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot/style.css') }}">

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

    <header class="main-header">
        <div class="header-content">
            <a href="{{ url_for('index') }}" class="logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="height: 80px;">
            </a>
            <nav class="main-nav">
                <ul>
                    <li><a href="#" class="active" onclick="showSection('commandCenter')">Command Center</a></li>
                    <li><a href="#" onclick="showSection('voterAnalytics')">Voter Analytics & Targeting</a></li>
                    <li><a href="#" onclick="showSection('campaignHub')">Campaign Management Hub</a></li>
                    <li><a href="#" onclick="showSection('boothStrategy')">Booth-Level Strategy</a></li>
                    <li><a href="#" onclick="showSection('chatbotSection')">AI Assistant</a></li>
                </ul>
            </nav>
            <div class="user-menu">
                <span>Welcome, Candidate</span>
                <a href="{{ url_for('index') }}" class="logout-btn">Logout</a>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            
            <section id="commandCenter" class="dashboard-section active">
                <h3>Command Center</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h4>Voters Contacted</h4>
                        <span id="kpiContacted" class="kpi-value">Loading...</span>
                        <div class="kpi-progress-bar"><div id="kpiContactedBar" style="width: 0%;"></div></div>
                    </div>
                    <div class="kpi-card supporters">
                        <h4>Supporters Identified</h4>
                        <span id="kpiSupporters" class="kpi-value">Loading...</span>
                    </div>
                    <div class="kpi-card undecided">
                        <h4>Undecided Voters</h4>
                        <span id="kpiUndecided" class="kpi-value">Loading...</span>
                    </div>
                    <div class="kpi-card tasks">
                        <h4>Tasks Completed</h4>
                        <span id="kpiTasks" class="kpi-value">Loading...</span>
                    </div>
                </div>

                <div class="command-center-grid">
                    <div class="activity-feed">
                        <h4>üì¢ Live Activity Feed</h4>
                        <ul id="activityFeedList">
                            <li>Loading feed...</li>
                        </ul>
                    </div>
                    <div class="ward-map">
                        <h4>üó∫Ô∏è Ward Map Overview</h4>
                        <div id="wardMapContainer">
                            <p style="text-align: center; padding-top: 50px;">Map will load here.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="voterAnalytics" class="dashboard-section" style="display:none;">
                <h3>Voter Analytics & Targeting</h3>
                
                <div class="analytics-layout">
                    <div class="filter-sidebar">
                        <h4>Voter Filters</h4>
                        
                        <div class="form-group">
                            <label for="filterAffiliation">Political Affiliation</label>
                            <select id="filterAffiliation">
                                <option value="">All</option>
                                <option value="Supporter">Supporter</option>
                                <option value="SwingVoter">SwingVoter / Neutral</option>
                                <option value="Opponent">Opponent</option>
                                <option value="Empty">Empty</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="filterGender">Gender</label>
                            <select id="filterGender">
                                <option value="">All</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filterAge">Age Group</label>
                            <select id="filterAge">
                                <option value="">All</option>
                                <option value="18-25">18-25</option>
                                <option value="26-40">26-40</option>
                                <option value="41-60">41-60</option>
                                <option value="60+">60+</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="filterWard">Ward / Booth</label>
                            <select id="filterWard">
                                <option value="">All Wards</option>
                                </select>
                        </div>

                        <div class="form-group">
                            <label for="filterEducation">Education Level</label>
                            <select id="filterEducation">
                                <option value="">All</option>
                                <option value="High School">High School</option>
                                <option value="Graduate">Graduate</option>
                                <option value="Post-Graduate">Post-Graduate</option>
                                </select>
                        </div>

                        <div class="form-group">
                            <label for="filterIssues">Key Issues</label>
                            <input type="text" id="filterIssues" placeholder="e.g., water, roads">
                        </div>
                        <div class="form-group">
                            <label for="filterOccupation">Occupation</label>
                            <input type="text" id="filterOccupation" placeholder="e.g., Shopkeeper">
                        </div>
                        
                        <button class="apply-filters-button" onclick="applyVoterFilters()">Apply Filters</button>
                        <button class="clear-filters-button" onclick="resetFilters()">Clear</button>
                        
                        <hr>
                        <div class="form-group">
                            <label for="segmentName">Save Filter as Segment</label>
                            <input type="text" id="segmentName" placeholder="e.g., Young Undecided Voters">
                        </div>
                        <button onclick="saveSegment()">Save Segment</button>
                    </div>
                    
                    <div class="analytics-main-content">
                        
                        <div id="voterStats" class="kpi-grid-small">
                            <div class="kpi-card-small supporters">
                                <h4>Supporters</h4>
                                <span id="supporterCount">--</span>
                            </div>
                            <div class="kpi-card-small undecided">
                                <h4>Swing Voters</h4>
                                <span id="swingCount">--</span>
                            </div>
                            <div class="kpi-card-small opponents">
                                <h4>Opponents</h4>
                                <span id="opponentCount">--</span>
                            </div>
                             <div class="kpi-card-small empty">
                                <h4>Empty</h4>
                                <span id="emptyCount">--</span>
                            </div>
                        </div>

                        <div class="analytics-charts">
                            <h4>üìä Visual Insights</h4>
                            <div class="chart-grid">
                                <div class="chart-container">
                                    <canvas id="affiliationChart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <canvas id="issueChart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <canvas id="genderChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="voter-list-section">
                            <div class="section-header">
                                <h4>Filtered Voter List (<span id="voterCount">0</span>)</h4>
                                <button onclick="exportVoters()">Export CSV</button>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Age</th>
                                            <th>Gender</th>
                                            <th>Affiliation</th>
                                            <th>Key Issues</th>
                                            
                                        </tr>
                                    </thead>
                                    <tbody id="analyticsVoterList"></tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            
            <section id="campaignHub" class="dashboard-section" style="display:none;">
                <h3>Campaign Management Hub</h3>
                <p class="section-subtitle">Direct your team by assigning tasks, sending targeted messages, and managing resources.</p>

                <div class="hub-nav">
                    <a href="#" id="navTasks" class="hub-nav-link active" onclick="showHubTab('hubTasks', this)">‚úÖ Master Task Manager</a>
                    <a href="#" id="navCommunicate" class="hub-nav-link" onclick="showHubTab('hubCommunicate', this)">üì¢ Targeted Communication</a>
                    <a href="#" id="navResources" class="hub-nav-link" onclick="showHubTab('hubResources', this)">üì¶ Resource Management</a>
                </div>

                <div id="hubTasks" class="hub-tab-content active">
                    <div class="task-manager-layout">
                        <div class="task-form-container">
                            <h4>Create & Assign Task</h4>
                            <form id="createTaskForm">
                                <div class="form-group">
                                    <label for="taskTitle">Task Title</label>
                                    <input type="text" id="taskTitle" placeholder="e.g., Distribute pamphlets" required>
                                </div>
                                <div class="form-group">
                                    <label for="taskAssignee">Assign To Worker</label>
                                    <select id="taskAssignee" required>
                                        <option value="">Select Worker...</option>
                                        <option value="1">Ram Patil</option>
                                        <option value="2">Sunita Devi</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taskDueDate">Due Date</label>
                                    <input type="date" id="taskDueDate">
                                </div>
                                <button type="submit">Assign Task</button>
                            </form>
                        </div>
                        <div class="task-list-container">
                            <h4>Current Tasks</h4>
                            <div class="table-responsive">
                                <table aria-label="Tasks table">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Assigned To</th>
                                            <th>Status</th>
                                            <th>Due Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="hubTasksTableBody">
                                        <tr><td colspan="4">Loading tasks...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="hubCommunicate" class="hub-tab-content">
                    <h4>Send Message to Voter Segment</h4>
                    <form id="sendMessageForm" class="form-grid">
                        <div class="form-group">
                            <label for="commSegment">Select Voter Segment</label>
                            <select id="commSegment" required>
                                <option value="">Select Segment...</option>
                                <option value="seg1">Young Undecided Voters</option>
                                <option value="seg2">Influential Senior Citizens</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="commTitle">Message Title / Subject</label>
                            <input type="text" id="commTitle" placeholder="e.g., Appeal to First-Time Voters" required>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="commBody">Message Body</label>
                            <textarea id="commBody" rows="5" placeholder="Write your message here..." required></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit">Send Message</button>
                        </div>

                    </form>
                </div>
                
                <div id="hubResources" class="hub-tab-content">
                    <h4>Campaign Materials Inventory</h4>
                    <div class="table-responsive">
                        <table aria-label="Resource table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Total Quantity</th>
                                    <th>Distributed</th>
                                    <th>Remaining</th>
                                </tr>
                            </thead>
                            <tbody id="hubResourcesTableBody">
                                <tr><td>Pamphlets</td><td>20,000</td><td>8,500</td><td>11,500</td></tr>
                                <tr><td>Flags</td><td>5,000</td><td>1,200</td><td>3,800</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="boothStrategy" class="dashboard-section" style="display:none;">
                <div class="section-header">
                    <h3>Booth-Level Strategy (War Room)</h3>
                    <button id="addNewBoothBtn" onclick="openBoothModal()">+ Add New Booth</button>
                </div>
                <p class="section-subtitle">Manage booth in-charges, generate voter slips, and track election day turnout.</p>
                <div class="booth-grid" id="boothGridContainer">
                    </div>
            </section>

            <div id="boothModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-btn" onclick="closeBoothModal()">&times;</span>
                    <h3 id="boothModalTitle">Add New Booth</h3>
                    <form id="boothForm" class="form-grid">
                        <input type="hidden" id="boothId">
                        <div class="form-group">
                            <label for="boothName">Booth Name</label>
                            <input type="text" id="boothName" placeholder="e.g., ZP Primary School" required>
                        </div>
                        <div class="form-group">
                            <label for="boothNumber">Booth Number</label>
                            <input type="text" id="boothNumber" placeholder="e.g., 24-A" required>
                        </div>
                        <div class="form-group">
                            <label for="inChargeName">In-Charge (Panna Pramukh)</label>
                            <input type="text" id="inChargeName" placeholder="Name of the worker">
                        </div>
                        <div class="form-group">
                            <label for="inChargeContact">In-Charge Contact</label>
                            <input type="text" id="inChargeContact" placeholder="Mobile number">
                        </div>
                        <div class="form-actions">
                            <button type="submit" id="saveBoothBtn">Save Booth</button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- ‚úÖ AI Assistant -->
            <div id="chatbotSection" class="dashboard-section" style="display:none;">
                <div class="chatbot-wrapper">
                    <h3>AI Assistant ü§ñ</h3>
                    <p class="subtitle">Ask campaign questions, booth strategy, voter insights ‚Äî anything!</p>

                    <div id="chatWindow" class="chat-window"></div>

                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Speak or type your question..." autocomplete="off" />
                        
                        <button id="voiceBtn" class="voice-btn" title="Voice Input üéôÔ∏è">
                            üéôÔ∏è
                        </button>

                        <button id="chatSendBtn">Send</button>
                    </div>
                    
                </div>
            </div>






        </div>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 Election Management System. All Rights Reserved.</p>
    </footer>

    <script src="{{url_for('static', filename = 'js/candidate.js')}}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>